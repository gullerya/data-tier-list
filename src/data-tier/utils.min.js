import{Observable as t}from"./object-observer.min.js";const e="defaultTieTarget",n="changeEventName",r=/\s*=>\s*/,i=/\s*[,;]\s*/,o={INPUT:1,SELECT:1,TEXTAREA:1},s={IMG:1,IFRAME:1,SOURCE:1},l={A:1,ANIMATE:1,AREA:1,BASE:1,DISCARD:1,IMAGE:1,LINK:1,PATTERN:1,use:1},a={INPUT:1,SELECT:1,TEXTAREA:1},c="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",u=c.length;export{e as DEFAULT_TIE_TARGET_PROVIDER,h as ensureObservable,p as getTargetProperty,d as extractViewParams,n as CHANGE_EVENT_NAME_PROVIDER,E as addChangeListener,A as delChangeListener,v as getPath,T as setPath,w as callViewFunction,P as getRandomKey};class f{constructor(t,e,n,r,i,o){this.tieKey=t,this.rawPath=e,this.path=n,this.targetProperty=r,this.isFunctional=i,this.fParams=o,this.iClasses=null}}function h(e){return e?t.isObservable(e)?e:t.from(e):t.from({})}function p(t){let n=t[e];if(!n){const e=t.nodeName;n="INPUT"===e&&"checkbox"===t.type?"checked":e in o?"value":e in s?"src":e in l?"href":"textContent"}return n}function d(t){const e=t.getAttribute("data-tie");if(e){const n=function(t,e){const n=[],r={},o=t.split(i),s=o.length;let l,a,c,u=0;for(;u<s;u++)if((l=o[u])&&(a&&(a+=","+l),!(l.indexOf("(")>0&&(a=l).indexOf(")")<0)))try{a?(c=g(a),a=null):c=m(l,e),c.targetProperty in r?console.error(`elements's property '${c.targetProperty}' tied more than once; all but first dismissed`):(n.push(c),r[c.targetProperty]=!0)}catch(t){console.error(`failed to parse one of a multi param parts (${l}), skipping it`,t)}return n}(e,t);return n.length?n:null}return null}function g(t){const e=t.split(/[()]/),n=e[1].split(/\s*,\s*/).map(t=>{const e=t.split(":");if(!e.length||e.length>2||!e[0])throw new Error("invalid function tied value: "+t);const n=e.length>1?e[1]:"";return{tieKey:e[0],rawPath:n,path:n.split(".").filter(t=>t)}});if(!n.length)throw new Error(`functional tie parameter MUST have at least one tied argument, '${t}' doesn't`);return new f(null,null,null,e[0],!0,n)}function m(t,e){const n=t.split(r);1===n.length&&n.push(p(e));const i=n[0].split(":");if(!i.length||i.length>2||!i[0])throw new Error(`invalid tie parameter '${t}'; expected (example): "orders:0.address.street, orders:0.address.apt => title"`);let o=i[0];const s=i.length>1?i[1]:"",l=new f(o,s,s.split(".").filter(t=>t),n[1],!1,null);return"classList"===l.targetProperty&&(l.iClasses=Array.from(e.classList)),l}function E(t,e){const n=y(t);n&&t.addEventListener(n,e)}function A(t,e){const n=y(t);n&&t.removeEventListener(n,e)}function y(t){let e=t[n];return e||t.nodeName in a&&(e="change"),e}function v(t,e){if(!t)return null;const n=e,r=n.length;if(!r)return t;let i,o=t,s=0;for(;s<r-1;s++)if(null===(o=o[i=n[s]])||void 0===o)return o;return o[n[s]]}function T(t,e,n){if(!t)return;const r=e.length;let i,o,s=0;for(;s<r-1;s++)if((o=t[i=e[s]])&&"object"==typeof o)t=o;else if(void 0===o||null===o)t[i]={},t=t[i];else if("object"!=typeof o)return void console.error("setting deep path MAY NOT override primitives along the way");t[e[s]]=n}function w(t,e,n){try{t[e].apply(t,n)}catch(r){console.error(`failed to call '${e}' of '${t}' with '${n}'`,r)}}function P(t){let e="",n=t;const r=crypto.getRandomValues(new Uint8Array(t));for(;n--;)e+=c.charAt(u*r[n]/256);return e}