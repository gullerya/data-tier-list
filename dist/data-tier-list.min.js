import*as DataTier from"./data-tier/data-tier.min.js";const SEQUENCE_ID_KEY=Symbol("sequence.id"),BOUND_UPDATER_KEY=Symbol("bound.updater"),ITEMS_KEY=Symbol("items.key"),PREPARED_TEMPLATE_KEY=Symbol("prepared.template");let sequencer=1;class DataTierList extends HTMLElement{constructor(){super(),this[SEQUENCE_ID_KEY]=sequencer++,this[BOUND_UPDATER_KEY]=this.fullUpdate.bind(this),this.attachShadow({mode:"open"}).innerHTML="<slot></slot>",this.shadowRoot.firstElementChild.addEventListener("slotchange",e=>{const t=e.target.assignedNodes().filter(e=>e.nodeType===Node.ELEMENT_NODE);1===t.length?(this.preprocessTemplate(t[0]),this.fullUpdate()):console.error(`list item template MUST have onle 1 root element, got ${t.length}`)})}connectedCallback(){this.style.display="none"}get defaultTieTarget(){return"items"}set items(e){if(!Array.isArray(e))return void console.error(`array of items expected, but got '${e}'`);let t;this[ITEMS_KEY]&&(this[ITEMS_KEY].unobserve(this[BOUND_UPDATER_KEY]),DataTier.ties.get(this)&&DataTier.ties.remove(this)),(t="function"==typeof e.observe&&"function"==typeof e.unobserve?e:DataTier.ties.create(this,e)).observe(this[BOUND_UPDATER_KEY]),this[ITEMS_KEY]=t,this.fullUpdate()}get items(){return this[ITEMS_KEY]}fullUpdate(e){if(!this[PREPARED_TEMPLATE_KEY]||!this[ITEMS_KEY])return;const t=this.resolveTargetContainer(),i=t.contains(this)?1:0;if(e){const s=document.createElement("template");e.forEach(e=>{if(!(e.path.length>1))if("insert"===e.type)s.innerHTML=this[PREPARED_TEMPLATE_KEY],t.insertBefore(s.content,t.children[e.path[0]+i]);else if("delete"===e.type)t.removeChild(t.children[e.path[0]+i]);else if("reverse"===e.type)for(var r=i+1,n=t.children.length-i/2;r<n;r++)t.insertBefore(t.children[r],t.children[r-1]);else console.warn(`unsupported change type ${e.type}`)})}else{const e=this.items,s=t.childElementCount-i,r=e.length;let n,o=s;for(;o>r;)(n=t.lastElementChild)!==this&&t.removeChild(n),o--;let a="";for(;o<r;)a+=this[PREPARED_TEMPLATE_KEY],o++;if(a){const e=document.createElement("template");e.innerHTML=a,t.appendChild(e.content)}for(let s=i,r=t.children.length;s<r;s++){const r=t.children[s],n=DataTier.ties.get(r);n?n!==e[s-i]&&DataTier.ties.update(r,e[s-i]):DataTier.ties.create(r,e[s-i])}}}resolveTargetContainer(){let e=this.parentElement;const t=this.getAttribute("data-list-target");return t&&(e=this.getRootNode().querySelector(t)),e}preprocessTemplate(e){this[PREPARED_TEMPLATE_KEY]=e.outerHTML}}customElements.get("data-tier-list")||customElements.define("data-tier-list",DataTierList);