import*as DataTier from"./data-tier/data-tier.min.js";const SEQUENCE_ID_KEY=Symbol("sequence.id"),BOUND_UPDATER_KEY=Symbol("bound.updater"),ITEMS_KEY=Symbol("items.key"),PREPARED_TEMPLATE_KEY=Symbol("prepared.template");let sequencer=1;class DataTierList extends HTMLElement{constructor(){super(),this[SEQUENCE_ID_KEY]=sequencer++,this[BOUND_UPDATER_KEY]=this.fullUpdate.bind(this),this.attachShadow({mode:"open"}).innerHTML="<slot></slot>",this.shadowRoot.firstElementChild.addEventListener("slotchange",e=>{const t=e.target.assignedNodes().filter(e=>e.nodeType===Node.ELEMENT_NODE);1===t.length?(this.preprocessTemplate(t[0]),this.fullUpdate()):console.error(`list item template MUST have onle 1 root element, got ${t.length}`)})}connectedCallback(){this.style.display="none",this.setAttribute("data-tier-blackbox","1")}get defaultTieTarget(){return"items"}set items(e){if(!Array.isArray(e))return void console.error(`array of items expected, but got '${e}'`);let t;this[ITEMS_KEY]&&(this[ITEMS_KEY].unobserve(this[BOUND_UPDATER_KEY]),DataTier.ties.get(this)&&DataTier.ties.remove(this)),(t="function"==typeof e.observe&&"function"==typeof e.unobserve?e:DataTier.ties.create(this,e)).observe(this[BOUND_UPDATER_KEY]),this[ITEMS_KEY]=t,this.fullUpdate()}get items(){return this[ITEMS_KEY]}fullUpdate(){if(!this[PREPARED_TEMPLATE_KEY])return;const e=this.resolveTargetContainer(),t=e.contains(this)?1:0,s=this.items,i=e.childElementCount-t,r=s.length;let a,o=i;for(;o>r;)(a=e.lastElementChild)!==this&&e.removeChild(a),o--;let n="";for(;o<r;)n+=this[PREPARED_TEMPLATE_KEY],o++;if(n){const t=document.createElement("template");t.innerHTML=n,e.appendChild(t.content)}Array.from(e.children).forEach((e,r)=>{if(r-t<i)return;const a=DataTier.ties.get(e);a?a!==s[r-t]&&DataTier.ties.update(e,s[r-t]):DataTier.ties.create(e,s[r-t])})}resolveTargetContainer(){let e=this.parentElement;const t=this.getAttribute("data-list-target");return t&&(e=this.getRootNode().querySelector(t)),e}preprocessTemplate(e){this[PREPARED_TEMPLATE_KEY]=e.outerHTML}}customElements.get("data-tier-list")||customElements.define("data-tier-list",DataTierList);