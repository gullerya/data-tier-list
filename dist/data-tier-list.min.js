import*as DataTier from"./data-tier/data-tier.min.js";const SEQUENCE_ID_KEY=Symbol("sequence.id"),PREPARED_TEMPLATE_KEY=Symbol("prepared.template");let sequencer=1;class DataTierList extends HTMLElement{constructor(){super(),DataTier.ties.create(this,[]).observe(()=>this.fullUpdate()),this[SEQUENCE_ID_KEY]=sequencer++,this.attachShadow({mode:"open"}).innerHTML="<slot></slot>",this.shadowRoot.firstElementChild.addEventListener("slotchange",e=>{const t=e.target.assignedNodes().filter(e=>e.nodeType===Node.ELEMENT_NODE);1===t.length?(this.preprocessTemplate(t[0]),this.fullUpdate()):console.error(`list item template MUST have onle 1 root element, got ${t.length}`)})}connectedCallback(){this.style.display="none",this.setAttribute("data-tier-blackbox","1")}get defaultTieTarget(){return"items"}set items(e){if(!Array.isArray(e))return void console.error(`array of items expected, but got '${e}'`);const t=DataTier.ties.get(this);t.splice(0,t.length,...e),this.fullUpdate()}get items(){return DataTier.ties.get(this)}fullUpdate(){if(!this[PREPARED_TEMPLATE_KEY])return;console.log("some");const e=this.resolveTargetContainer(),t=e.contains(this)?1:0,s=this.items,i=s.length;let r,a=e.childElementCount-t;for(;a>i;)(r=e.lastElementChild)!==this&&e.removeChild(r),a--;let o="";for(;a<i;)o+=this[PREPARED_TEMPLATE_KEY],a++;if(o){const t=document.createElement("template");t.innerHTML=o,e.appendChild(t.content)}Array.from(e.children).forEach((e,i)=>{if(t&&0===i)return;const r=DataTier.ties.get(e);r?Object.assign(r,s[i-t]):DataTier.ties.create(e,s[i-t])})}resolveTargetContainer(){let e=this.parentElement;const t=this.getAttribute("data-list-target");return t&&(e=this.getRootNode().querySelector(t)),e}preprocessTemplate(e){e.setAttribute("data-tie-scope","1"),this[PREPARED_TEMPLATE_KEY]=e.outerHTML}}customElements.get("data-tier-list")||customElements.define("data-tier-list",DataTierList);