import*as DataTier from"./data-tier/data-tier.min.js";const LISTS_MODEL_TIE_NAME="listsModel",listsModel=DataTier.ties.create(LISTS_MODEL_TIE_NAME),SEQUENCE_ID_KEY=Symbol("sequence.id"),INDEX_PLACEHOLDER="dtl_index_placeholder",PREPARED_TEMPLATE_KEY=Symbol("prepared.template");let sequencer=1;class DataTierList extends HTMLElement{constructor(){super(),this[SEQUENCE_ID_KEY]=sequencer++,this.attachShadow({mode:"open"}).innerHTML="<slot></slot>",this.shadowRoot.firstElementChild.addEventListener("slotchange",e=>{const t=e.target.assignedNodes().filter(e=>e.nodeType===Node.ELEMENT_NODE);1===t.length?(this.preprocessTemplate(t[0]),this.fullUpdate()):console.error(`list item template MUST have onle 1 root element, got ${t.length}`)})}connectedCallback(){this.style.display="none",this.setAttribute("data-tier-blackbox","1"),listsModel[this[SEQUENCE_ID_KEY]]=[]}disconnectedCallback(){delete listsModel[this[SEQUENCE_ID_KEY]]}get defaultTieTarget(){return"items"}set items(e){if(Array.isArray(e)){for(let t=0,s=e.length;t<s;t++)t>=listsModel[this[SEQUENCE_ID_KEY]].length&&listsModel[this[SEQUENCE_ID_KEY]].push(e[t]);this.fullUpdate()}else console.error(`array of items expected, but got '${e}'`)}resolveTargetContainer(){let e=this.parentElement;const t=this.getAttribute("data-list-target");return t&&(e=this.getRootNode().querySelector(t)),e}fullUpdate(){if(!this[PREPARED_TEMPLATE_KEY])return;const e=this.resolveTargetContainer(),t=e.contains(this)?1:0,s=listsModel[this[SEQUENCE_ID_KEY]].length;let l,i=e.childElementCount-t;for(;i>s;)(l=e.lastElementChild)!==this&&e.removeChild(l),i--;let E="";const r=new RegExp(INDEX_PLACEHOLDER,"g");for(;i<s;)E+=this[PREPARED_TEMPLATE_KEY].replace(r,i),i++;if(E){const t=document.createElement("template");t.innerHTML=E,e.appendChild(t.content)}}preprocessTemplate(e){const t=`${LISTS_MODEL_TIE_NAME}:${this[SEQUENCE_ID_KEY]}.${INDEX_PLACEHOLDER}`,s=e.cloneNode(!0),l=[s];s.childElementCount&&Array.prototype.push.apply(l,s.querySelectorAll("*"));let i,E,r=l.length;for(;r;)(E=(i=l[--r]).getAttribute("data-tie"))&&i.setAttribute("data-tie",E.replace(/item:/g,`${t}.`).replace(/item\s*=/g,`${t}=`).replace(/item(?![.a-zA-Z0-9])/g,`${t}`));this[PREPARED_TEMPLATE_KEY]=s.outerHTML}}customElements.get("data-tier-list")||customElements.define("data-tier-list",DataTierList);